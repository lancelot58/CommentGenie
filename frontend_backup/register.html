<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注册 - 学生评语生成器</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- 标题 -->
        <h1>创建账号</h1>
        <p class="subtitle">开始使用 AI 生成学生评语</p>

        <!-- 消息提示区域 -->
        <div id="message"></div>

        <!-- 注册表单 -->
        <form id="registerForm">
            <div class="form-group">
                <label for="username">用户名</label>
                <input
                    type="text"
                    id="username"
                    name="username"
                    placeholder="3-20个字符"
                    required
                    minlength="3"
                    maxlength="20"
                    autocomplete="username"
                >
                <small style="color: #999; font-size: 12px;">用户名将用于登录</small>
            </div>

            <div class="form-group">
                <label for="password">密码</label>
                <input
                    type="password"
                    id="password"
                    name="password"
                    placeholder="至少6个字符"
                    required
                    minlength="6"
                    autocomplete="new-password"
                >
            </div>

            <div class="form-group">
                <label for="confirmPassword">确认密码</label>
                <input
                    type="password"
                    id="confirmPassword"
                    name="confirmPassword"
                    placeholder="再次输入密码"
                    required
                    autocomplete="new-password"
                >
            </div>

            <div class="form-group">
                <label for="email">邮箱（可选）</label>
                <input
                    type="email"
                    id="email"
                    name="email"
                    placeholder="example@email.com"
                    autocomplete="email"
                >
            </div>

            <button type="submit" class="btn" id="registerBtn">
                注册
            </button>
        </form>

        <!-- 登录链接 -->
        <div class="link">
            已有账号？<a href="login.html">立即登录</a>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // 注册表单提交处理
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const email = document.getElementById('email').value.trim();
            const registerBtn = document.getElementById('registerBtn');

            // 验证输入
            if (!username || !password) {
                showMessage('请填写完整信息', 'error');
                return;
            }

            if (username.length < 3 || username.length > 20) {
                showMessage('用户名长度必须在3-20个字符之间', 'error');
                return;
            }

            if (password.length < 6) {
                showMessage('密码长度至少6个字符', 'error');
                return;
            }

            if (password !== confirmPassword) {
                showMessage('两次输入的密码不一致', 'error');
                return;
            }

            // 禁用按钮，显示加载状态
            registerBtn.disabled = true;
            registerBtn.innerHTML = '注册中<span class="loading"></span>';

            try {
                // 调用注册函数
                const result = await register(username, password, email);

                if (result.success) {
                    showMessage('注册成功！正在跳转到登录页...', 'success');
                    // 延迟跳转
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1500);
                } else {
                    showMessage(result.message || '注册失败，请重试', 'error');
                    registerBtn.disabled = false;
                    registerBtn.innerHTML = '注册';
                }
            } catch (error) {
                showMessage('网络错误，请检查服务器是否启动', 'error');
                registerBtn.disabled = false;
                registerBtn.innerHTML = '注册';
            }
        });

        // 显示消息提示
        function showMessage(text, type = 'info') {
            const messageDiv = document.getElementById('message');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            messageDiv.style.display = 'block';

            // 3秒后自动隐藏（错误消息除外）
            if (type !== 'error') {
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 3000);
            }
        }

        // 页面加载时检查是否已登录
        window.addEventListener('load', () => {
            if (isLoggedIn()) {
                window.location.href = 'index.html';
            }
        });
    </script>
</body>
</html>
